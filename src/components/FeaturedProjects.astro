---
import { useTranslations, type Lang } from "../utils/i18n";
import projectsData from "../data/projects.json";

export interface Props {
  lang?: Lang;
}

const { lang } = Astro.props;
const currentLang = lang || "en";
const t = useTranslations(currentLang);

// Filter featured projects (max 4)
const featuredProjects = projectsData.projects
  .filter((project) => project.featured)
  .slice(0, 4);

// Helper function to get project description
const getProjectDescription = (projectId: string) => {
  return t(`projects.${projectId}` as any);
};
---

<section id="projects" class="projects-section">
  <div class="container">
    <div class="projects-content">
      <!-- Section Header -->
      <div class="projects-header">
        <h2 class="section-title">{t("home.projects.title")}</h2>
        <p class="section-subtitle">{t("home.projects.subtitle")}</p>
      </div>

      <!-- Projects Grid -->
      <div class="projects-grid">
        {
          featuredProjects.map((project) => (
            <article class="project-card">
              <a
                href={project.demoUrl || "#"}
                target={project.demoUrl ? "_blank" : "_self"}
                rel={project.demoUrl ? "noopener noreferrer" : ""}
                class="project-link"
              >
                <div class="project-image">
                  <img
                    src={`/images/projects/${project.image}`}
                    alt={project.title}
                    loading="lazy"
                  />
                  <div class="project-overlay">
                    <span class="view-project">
                      {t("home.projects.viewProject")}
                    </span>
                  </div>
                </div>

                <div class="project-info">
                  <div class="project-header">
                    <h3 class="project-title">{project.title}</h3>
                    <span class="project-client">{project.client}</span>
                  </div>

                  <p class="project-description">{getProjectDescription(project.id)}</p>

                  <div class="project-technologies">
                    {project.technologies.slice(0, 4).map((tech) => (
                      <span class="tech-tag">{tech}</span>
                    ))}
                    {project.technologies.length > 4 && (
                      <span class="tech-more">
                        +{project.technologies.length - 4}
                      </span>
                    )}
                  </div>
                </div>
              </a>
            </article>
          ))
        }
      </div>

      <!-- View All Button -->
      <div class="projects-cta">
        <a href={`/${lang === 'en' ? '' : lang + '/'}projects`} class="btn-primary">
          {t("home.projects.viewAll")}
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path
              d="M6 3L11 8L6 13"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<style lang="scss">
  @use "../_mediaqueries.scss" as *;
  @use "../styles/variables" as *;

  .projects-section {
    padding: var(--space-20) 0;
    background: var(--color-surface);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-6);
  }

  .projects-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-12);
  }

  // Header
  .projects-header {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .section-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    margin: 0 0 var(--space-4) 0;

    @include md {
      font-size: var(--font-size-5xl);
    }
  }

  .section-subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
  }

  // Projects Grid
  .projects-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-8);

    @include md {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .project-card {
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-base);

    &:hover {
      border-color: var(--color-primary-200);
      box-shadow: var(--shadow-lg);
      transform: translateY(-4px);

      .project-overlay {
        opacity: 1;
      }

      .project-image img {
        transform: scale(1.05);
      }
    }
  }

  .project-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .project-image {
    position: relative;
    width: 100%;
    height: 240px;
    overflow: hidden;
    background: var(--color-surface);

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--transition-base);
    }
  }

  .project-overlay {
    position: absolute;
    inset: 0;
    background: rgba(6, 78, 59, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity var(--transition-base);
  }

  .view-project {
    color: var(--color-accent-50);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .project-info {
    padding: var(--space-6);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .project-header {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .project-title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin: 0;
  }

  .project-client {
    font-size: var(--font-size-sm);
    color: var(--color-primary-500);
    font-weight: var(--font-weight-medium);
  }

  .project-description {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  .project-technologies {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .tech-tag {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-3);
    background: var(--color-primary-100);
    color: var(--color-primary-700);
    border-radius: var(--radius-full);
    font-weight: var(--font-weight-medium);
  }

  .tech-more {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-3);
    background: var(--color-surface);
    color: var(--color-text-tertiary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-weight: var(--font-weight-medium);
  }

  // CTA
  .projects-cta {
    display: flex;
    justify-content: center;
    margin-top: var(--space-8);
  }

  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-8);
    background: var(--color-primary-600);
    color: var(--color-primary-50);
    border-radius: var(--radius-base);
    font-weight: var(--font-weight-semibold);
    text-decoration: none;
    transition: all var(--transition-base);

    &:hover {
      background: var(--color-primary-700);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    svg {
      transition: transform var(--transition-base);
    }

    &:hover svg {
      transform: translateX(4px);
    }
  }
</style>
